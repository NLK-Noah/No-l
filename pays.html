<!DOCTYPE html>
<html>
<head>
  <link rel="icon" type="image/png" href="static/naima.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Chango&display=swap" rel="stylesheet">
  <title>Le Festin d'Hiver</title>

  <!-- CSS -->
  <link rel="stylesheet" href="static/bac.css">
  
</head>

<body>
  <!-- Espace sous la guirlande -->
  <div class="header-space"></div>

  <div id="snow-container"></div>
     

  <!-- Formulaire -->
  <div class="login-container">
    <h1 id="lettre">C</h1>
    <p>DONNES MOI UN PAYS AVEC CETTE LETTRE</p>
    <p>Inscrit ta réponse</p>
    <input type="text" id="réponse" placeholder="Ta réponse ici" />
    <button id="réponse-btn">Valider</button>
    <a href="métier.html">
    <button id="pass">Je passe</button>
    </a>
  </div>

  <!-- JS -->
<!-- Script en module -->
    <script type="module" src="static/bac.js "></script>
    <script src="static/snow.js"></script>
    <script type="module">
        // Importation des fonctions Firebase nécessaires, y compris addDoc
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";


import { 
    getFirestore,
    collection,
    query,
    where,
    getDocs,
    addDoc,
    updateDoc,
    serverTimestamp,
    onSnapshot,
    orderBy,
    doc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// Configuration Firebase (Utilisez VOTRE configuration exacte)
const firebaseConfig = {
    apiKey: "AIzaSyBVQh_y9U1D5gA7BmCCFJgOlEPlUAogxV8",
    authDomain: "santa-secret-3c1f4.firebaseapp.com",
    projectId: "santa-secret-3c1f4",
    storageBucket: "santa-secret-3c1f4.firebasestorage.app",
    messagingSenderId: "238129661360",
    appId: "1:238129661360:web:d6ccb73539dc67d9f68275"
};

// Initialisation Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);



async function submitAnswer(paysName) {
    const username = localStorage.getItem('username');

    if (!username) {
        alert("Nom d'utilisateur non trouvé.");
        window.location.href = 'menu.html';
        return;
    }

    try {
        // 1. Chercher le document du joueur
        const q = query(
            collection(db, "responses"),
            where("user", "==", username)
        );
        console.log("coucou")
        console.log(q);
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
            console.error("Aucun document trouvé pour ce joueur.");
            alert("Aucun document 'responses' trouvé pour cet utilisateur.");
            return;
        }

        // 2. Mettre à jour le document trouvé
        querySnapshot.forEach(async (document) => {
            await updateDoc(document.ref, {
                pays: paysName
            });
        });

        // 3. Redirection
        window.history.replaceState(null, null, 'métier.html');
        window.location.href = 'métier.html';

    } catch (error) {
        console.error("Erreur lors de l'enregistrement de la réponse :", error);
        alert("Une erreur est survenue lors de l'enregistrement.");
    }
}


        // --- 3. Gestionnaires d'événements (Event Listeners) ---

        // Gère le bouton "Valider"
        document.getElementById("réponse-btn").addEventListener("click", () => {
            const inputElement = document.getElementById('réponse');
            const answer = inputElement.value.trim();

            if (answer === "") {
                alert("Veuillez entrer un pays ou appuyer sur 'Je passe'.");
                return;
            }
            // Notez que nous passons la réponse ici, ce n'est plus un "animalName"
            submitAnswer(answer); 
        });

        // Gère le bouton "Je passe"
        document.getElementById("pass").addEventListener("click", (event) => {
            event.preventDefault(); // Empêche l'<a> d'aller directement à métier.html
            submitAnswer("None"); // Enregistre "None" pour le pays
        });
    </script>
</body>
</html>